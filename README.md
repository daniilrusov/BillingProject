# Решение по курсу Практикум по разработке ML сервисов
API реализовано с помощью fastapi, очередь задач - celery.

[open_api.json](./openapi.json) auto generated, [Схема БД](./db.png)

## Логика биллинга
При регистрации пользователю выдается 1000 кредитов.
Для выбора предлагается три модели с разной ценой. Пользователь может отправить данные для одной из них, у него будет списана цена за запрос. Если выполнение запроса было прервано с ошибкой (если пользователь ввел отрицательное число в одно из полей), пользователю будут возвращены его кредиты.
### Модели
Используются Random Forest, XGBoost, CatBoost с ценой в 10, 20, 30 кредитов соответственно.
## Описание проекта
Проект разделен на несколько модулей:
 - controllers - набор контроллеров, отвечающих за различные части работы сервиса;
 - data_access - модуль, отвечающий за работу с базой данных (sqlalchemy);
 - dataobjects - определяет базовые обьекты для передачи данных внутри сервиса;
 - models - файлы сохраненных моделей.
### Модуль контроллеров
Присутствуют следующие контроллеры:
- main - реализует фасад для остальных контроллеров, выступает как интерфейс для работы с системой и определяет логику биллинга;
- user - используется для работы с сущностью пользователя;
- model - предоставляет ML модели для запуска задач;
- job - отвечает за работу с очередью задач;
- auth - реализует механизмы авторизации пользователя при помощи jwt.
### Очередь задач
Очередь задач реализована с помощью celery. Используются callback и errback для того, чтоб сохранить результат выполнения задачи в БД.
### Веб-интерфейс
Интерфейс пользователя выполнен в виде SPA, сервинг при помощи статических файлов fastapi, взаимодействие с сервером при помощи JS.
### Запуск проекта
Проект контейнеризован при помощи docker, можно запустить при помощи:
```shell
docker-compose up --build
```
